# 벡터 데이터베이스 관리 시스템 E2E 테스트

이 디렉토리는 벡터 데이터베이스 관리 시스템의 종합적인 E2E 테스트를 포함합니다.

## 테스트 파일 구조

### 1. 기본 관리 기능 테스트
- **`vector-management.spec.ts`** - 기본 관리자 접근 및 컬렉션 관리 테스트
- **`vector-management-final.spec.ts`** - 최종 통합 테스트 (모든 기본 기능)

### 2. 검색 기능 테스트
- **`search-functionality.spec.ts`** - 벡터 검색 기능 종합 테스트
  - 의미 기반 벡터 검색 (Semantic Search)
  - 키워드 검색 (Keyword Search)  
  - 하이브리드 검색 (Hybrid Search)
  - 검색 필터링 및 결과 표시
  - 검색 성능 및 응답성 테스트
  - 오류 처리 및 엣지 케이스

### 3. 성능 및 부하 테스트
- **`performance-load.spec.ts`** - 시스템 성능 및 부하 테스트
  - 대용량 파일 (10MB+) 처리 성능
  - 동시 다중 파일 업로드 부하 테스트
  - 벡터 검색 응답 시간 (3초 이내 요구사항)
  - AI 에이전트 RAG 검색 성능 (1초 이내 요구사항)
  - 메모리 사용량 및 리소스 최적화
  - 네트워크 요청 최적화

### 4. 보안 테스트
- **`security-tests.spec.ts`** - 보안 취약점 및 권한 테스트
  - 관리자 권한 우회 시도 방어
  - 파일 업로드 보안 검증 (악성 파일, 크기 제한)
  - SQL 인젝션 및 XSS 공격 방어
  - API 엔드포인트 보안 (인증되지 않은 접근 차단)
  - 민감한 정보 노출 방지

### 5. AI 에이전트 RAG 통합 테스트
- **`ai-agent-rag.spec.ts`** - AI 에이전트와 RAG 시스템 통합 테스트
  - AI 에이전트와 벡터 검색 연동
  - RAG 기반 답변 생성 품질
  - 검색 실패 시 폴백 메커니즘
  - 출처 정보 및 신뢰도 점수 표시
  - 스트리밍 응답과 RAG 통합

## 테스트 실행 방법

### 개별 테스트 실행
```bash
# 검색 기능 테스트
npm run test:e2e:search

# 성능 테스트
npm run test:e2e:performance

# 보안 테스트
npm run test:e2e:security

# AI RAG 통합 테스트
npm run test:e2e:rag

# 기존 기본 테스트
npm run test:e2e:final
```

### 전체 테스트 실행
```bash
# 모든 새로운 E2E 테스트 실행
npm run test:e2e:all-new

# 모든 E2E 테스트 실행 (기존 + 신규)
npm run test:e2e

# UI 모드로 테스트 실행
npm run test:e2e:ui

# 헤드리스 모드로 테스트 실행
npm run test:e2e:headed

# 디버그 모드로 테스트 실행
npm run test:e2e:debug
```

### 테스트 결과 확인
```bash
# 테스트 리포트 보기
npm run test:e2e:report
```

## 테스트 환경 설정

### 필수 조건
1. **Playwright 설치**: `npm install @playwright/test`
2. **브라우저 설치**: `npx playwright install`
3. **환경 변수 설정**: 
   - Supabase 연결 정보
   - AI API 키 (Claude, Mistral)
   - 테스트 데이터베이스 설정

### 테스트 데이터 준비
- 테스트용 컬렉션 및 문서 데이터
- 다양한 파일 형식의 샘플 파일
- 테스트용 사용자 계정 (관리자/일반 사용자)

## 테스트 시나리오 상세

### 검색 기능 테스트 시나리오
1. **의미 검색**: 자연어 질문에 대한 의미적 유사도 기반 검색
2. **키워드 검색**: 정확한 키워드 매칭 및 불린 연산자 지원
3. **하이브리드 검색**: 의미 검색과 키워드 검색의 결합
4. **필터링**: 컬렉션, 파일 타입, 날짜 범위별 필터링
5. **성능**: 3초 이내 응답 시간 보장

### 성능 테스트 시나리오
1. **대용량 파일**: 10MB+ 파일의 업로드 및 처리 성능
2. **동시 업로드**: 여러 파일의 동시 업로드 처리
3. **메모리 관리**: 메모리 누수 및 리소스 최적화 확인
4. **네트워크 최적화**: 불필요한 요청 최소화

### 보안 테스트 시나리오
1. **권한 검증**: 관리자 권한 우회 시도 차단
2. **파일 보안**: 악성 파일 업로드 차단
3. **인젝션 방어**: SQL 인젝션, XSS 공격 방어
4. **정보 보호**: 민감한 정보 노출 방지

### RAG 통합 테스트 시나리오
1. **검색 연동**: 벡터 검색과 AI 응답 생성 연동
2. **품질 검증**: RAG 기반 답변의 정확성 및 관련성
3. **출처 표시**: 답변에 대한 출처 정보 및 신뢰도 점수
4. **스트리밍**: 실시간 응답 생성 및 사용자 상호작용

## 테스트 결과 해석

### 성공 기준
- **검색 성능**: 평균 응답 시간 3초 이내
- **RAG 성능**: 문서 검색 1초 이내
- **파일 처리**: 10MB 파일 2분 이내 처리
- **보안**: 모든 권한 우회 시도 차단
- **메모리**: 메모리 증가율 50% 이내

### 실패 시 대응
1. **성능 이슈**: 인덱스 최적화, 캐싱 전략 검토
2. **보안 이슈**: 권한 검증 로직 강화
3. **기능 이슈**: 서비스 로직 및 UI 컴포넌트 수정
4. **통합 이슈**: API 연동 및 데이터 흐름 검토

## 지속적 통합 (CI)

### GitHub Actions 설정
```yaml
name: E2E Tests
on: [push, pull_request]
jobs:
  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npx playwright install
      - run: npm run test:e2e:all-new
```

### 테스트 병렬 실행
- 검색, 성능, 보안, RAG 테스트를 병렬로 실행
- 테스트 시간 단축 및 효율성 향상

## 문제 해결

### 일반적인 문제
1. **타임아웃 오류**: 네트워크 지연 또는 서버 응답 지연
2. **요소 찾기 실패**: UI 변경으로 인한 셀렉터 업데이트 필요
3. **권한 오류**: 테스트 환경의 인증 설정 확인
4. **파일 업로드 실패**: 파일 경로 및 권한 확인

### 디버깅 팁
1. **스크린샷 활용**: 실패 시점의 화면 캡처
2. **로그 분석**: 브라우저 콘솔 및 네트워크 로그 확인
3. **단계별 실행**: 개별 테스트 케이스 단위로 실행
4. **환경 검증**: 테스트 환경과 개발 환경의 일치성 확인

## 기여 가이드

### 새로운 테스트 추가
1. 적절한 테스트 파일에 테스트 케이스 추가
2. 테스트 설명 및 예상 결과 명시
3. 오류 처리 및 정리 코드 포함
4. README 업데이트

### 테스트 유지보수
1. UI 변경 시 셀렉터 업데이트
2. 새로운 기능 추가 시 테스트 케이스 추가
3. 성능 기준 변경 시 테스트 조건 업데이트
4. 정기적인 테스트 실행 및 결과 검토